---
title: "Homework 5"
author: "Lisa Eisler"
date: "11/6/2019"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(purrr)
```


# Problem 1

#### Load IRIS data from the tidyverse

```{r}
set.seed(10)

iris_with_missing = iris %>% 
  map_df(~replace(.x, sample(1:150, 20), NA)) %>%
  mutate(Species = as.character(Species))
```

*The data appears to be measurements of individual iris flowers (petal and sepal lengths and widths to the nearest 10th of a unit). Included also are species names.*

#### For numeric variables, you should fill in missing values with the mean of non-missing values. For character variables, you should fill in missing values with "virginica."

```{r}
replace_na = function(x) {
  output = vector(length = length(x))
  for (i in 1:length(x)) {
    if (is.numeric(x[i])) {
      mean_i = mean(x[!is.na(x)])
      if (!is.na(x[i])) {
        output[i] = x[i]
      } else {
        output[i] = mean_i
      }
    } else if (is.character(x[i])) {
      if (!is.na(x[i])) {
        output[i] = x[i]
      } else {
        output[i] = "virginica"
      }
    }
  }
  output
}
iris_complete = map(iris_with_missing, replace_na) %>%
  as.data.frame()
```

# Problem 2

Create a tidy dataframe containing data from all participants, including the subject ID, arm, and observations over time:

Start with a dataframe containing all file names; the list.files function will help
Iterate over file names and read in data for each subject using purrr::map and saving the result as a new variable in the dataframe
Tidy the result; manipulate file names to include control arm and subject ID, make sure weekly observations are “tidy”, and do any other tidying that’s necessary
Make a spaghetti plot showing observations on each subject over time, and comment on differences between groups.

```{r}
filenames = list.files("data")
experiment_data = 
  tibble(
    filenames = list.files("data"),
    path = str_c("./data/", filenames)
  ) %>% 
  mutate(
    data = map(path, read_csv)
  ) %>% 
  unnest() %>% 
  select(-path) %>% 
  pivot_longer(
    week_1:week_8,
    names_to = "week",
    values_to = "obs"
  ) %>% 
  mutate(
    arm = substr(filenames, 1, 3),
    arm = recode(arm, "con" = "control",
                      "exp" = "experiment"),
    subject_id = substr(filenames, 5, 6),
    subject_id = as.numeric(subject_id)
  ) 
```